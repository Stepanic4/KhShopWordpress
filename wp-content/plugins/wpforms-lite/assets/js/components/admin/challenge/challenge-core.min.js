"use strict";if(void 0===WPFormsChallenge)var WPFormsChallenge={};WPFormsChallenge.core=window.WPFormsChallenge.core||function(e,t,l){var o={initialSecondsLeft:60*WPFormsChallenge.admin.l10n.minutes_left,loadId:function(){return localStorage.getItem("wpformsChallengeTimerId")},saveId:function(e){localStorage.setItem("wpformsChallengeTimerId",e)},run:function(e){if(5!==n.loadStep()){var t=setInterval(function(){n.updateTimerUI(e),--e<0&&(o.saveSecondsLeft(0),clearInterval(t))},1e3);return o.saveId(t),t}},pause:function(){var e,t;0!==o.getSecondsLeft()&&5!==n.loadStep()&&(e=o.loadId(),clearInterval(e),(t=l("#wpforms-challenge-timer").data("seconds-left"))&&o.saveSecondsLeft(t))},resume:function(){var e,t=o.getSecondsLeft();0!==t&&5!==n.loadStep()&&((e=o.loadId())&&clearInterval(e),o.run(t))},clear:function(){localStorage.removeItem("wpformsChallengeSecondsLeft"),localStorage.removeItem("wpformsChallengeTimerId"),localStorage.removeItem("wpformsChallengeTimerStatus"),l("#wpforms-challenge-timer").removeData("seconds-left")},getSecondsLeft:function(){var e=localStorage.getItem("wpformsChallengeSecondsLeft");return e=parseInt(e,10)||0},getSecondsSpent:function(e){return e=e||o.getSecondsLeft(),o.initialSecondsLeft-e},saveSecondsLeft:function(e){localStorage.setItem("wpformsChallengeSecondsLeft",e)},getMinutesFormatted:function(e){return e=e||o.getSecondsLeft(),Math.floor(e/60)},getSecondsFormatted:function(e){return(e=e||o.getSecondsLeft())%60},getFormatted:function(e){e=e||o.getSecondsLeft();var t=o.getMinutesFormatted(e),n=o.getSecondsFormatted(e);return t+(9<n?":":":0")+n}},n={timer:o,init:function(){l(e).ready(n.ready),l(t).load(n.load)},ready:function(){n.setup(),n.events()},load:function(){n.timer.run(n.timer.getSecondsLeft())},setup:function(){var e,t=n.timer.loadId();t&&(clearInterval(t),e=n.timer.getSecondsLeft()),t||0!==n.loadStep()||(e=n.timer.initialSecondsLeft),n.refreshStep(),n.updateListUI(),n.updateTimerUI(e)},events:function(){l([t,e]).blur(function(){n.timer.pause()}),l([t,e]).focus(function(){n.timer.resume()}),l(".wpforms-challenge-cancel").click(function(){n.timer.pause(),n.cancelChallenge()})},loadStep:function(){var e=localStorage.getItem("wpformsChallengeStep");return e=parseInt(e,10)||0},saveStep:function(e){return localStorage.setItem("wpformsChallengeStep",e),WPFormsChallenge.admin.saveChallengeOption({step:e})},refreshStep:function(){var e=l(".wpforms-challenge").data("wpforms-challenge-saved-step");e=parseInt(e,10)||0,n.loadStep()!==e&&n.saveStep(e)},stepCompleted:function(e){return n.updateListUI(e),n.updateTooltipUI(e),n.saveStep(e)},initTooltips:function(n,e,t){var o=l('<span class="wpforms-challenge-dot wpforms-challenge-dot-step'+n+'" data-wpforms-challenge-step="'+n+'">&nbsp;</span>'),a={content:l("#tooltip-content"+n),trigger:null,interactive:!0,animationDuration:0,delay:0,theme:["tooltipster-default","wpforms-challenge-tooltip"],functionReady:function(e,t){l(t.tooltip).addClass("wpforms-challenge-tooltip-step"+n),e.reposition()}};"object"==typeof t&&null!==t&&l.extend(a,t),o.insertAfter(e).tooltipster(a)},updateTooltipUI:function(e){var a;e=e||n.loadStep(),a=e+1,l(".wpforms-challenge-dot").each(function(e,t){var n=l(t),o=n.data("wpforms-challenge-step");o<a&&n.addClass("wpforms-challenge-dot-completed"),a<o&&n.addClass("wpforms-challenge-dot-next"),o===a&&n.removeClass("wpforms-challenge-dot-completed wpforms-challenge-dot-next"),setTimeout(function(){n.is(":visible")&&o===a?n.tooltipster("open"):n.tooltipster("close")},0)})},updateListUI:function(e){e=e||n.loadStep(),l(".wpforms-challenge-list li:lt("+e+")").addClass("wpforms-challenge-item-completed"),l(".wpforms-challenge-list li:eq("+e+")").addClass("wpforms-challenge-item-current"),l(".wpforms-challenge-bar div").css("width",20*e+"%")},updateTimerUI:function(e){e&&!isNaN(e)&&"0"!==e||(e=0),n.timer.saveSecondsLeft(e),l("#wpforms-challenge-timer").text(n.timer.getFormatted(e)).data("seconds-left",e)},removeChallengeUI:function(){l(".wpforms-challenge-dot").remove(),l(".wpforms-challenge").remove()},clearLocalStorage:function(){localStorage.removeItem("wpformsChallengeStep"),n.timer.clear()},cancelChallenge:function(){var e={status:"canceled",seconds_spent:n.timer.getSecondsSpent(),seconds_left:n.timer.getSecondsLeft(),feedback_sent:!1};n.removeChallengeUI(),n.clearLocalStorage(),"undefined"!=typeof WPFormsBuilder?WPFormsChallenge.admin.saveChallengeOption(e).done(WPFormsBuilder.formSave).done(location.reload.bind(location)):WPFormsChallenge.admin.saveChallengeOption(e).done(n.triggerPageSave)},isGutenberg:function(){return"undefined"!=typeof wp&&wp.hasOwnProperty("blocks")},triggerPageSave:function(){n.isGutenberg()?l(".gutenberg .editor-post-publish-button").trigger("click"):l("#post #publish").trigger("click")}};return n}(document,window,jQuery),WPFormsChallenge.core.init();